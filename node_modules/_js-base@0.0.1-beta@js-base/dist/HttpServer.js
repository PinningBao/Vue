var Http = require("http");
var Util = require("util");
var FS = require("fs");
var HttpStatusCodes = require("http-status-codes");
var DbCommand_1 = require("./DbCommand");
var Search_1 = require("./Search");
var ArgumentNullError_1 = require("./ArgumentNullError");
var HttpServer = (function () {
    function HttpServer(appInfo, config, dbProcessor) {
        this.actionMap = {
            "GET": this.processGetAction.bind(this),
            "POST": this.processPostAction.bind(this),
            "PUT": this.processPutAction.bind(this),
            "DELETE": this.processDeleteAction.bind(this)
        };
        if (!appInfo)
            throw new ArgumentNullError_1.ArgumentNullError("appInfo");
        if (!config)
            throw new ArgumentNullError_1.ArgumentNullError("config");
        if (!dbProcessor)
            throw new ArgumentNullError_1.ArgumentNullError("dbProcessor");
        this.appInfo = appInfo;
        this.config = config;
        this.dbProcessor = dbProcessor;
        this.server = Http.createServer(this.handleRequest.bind(this));
    }
    HttpServer.prototype.run = function () {
        var _this = this;
        this.server.listen(this.config.port, function () {
            console.log("Server listening on port %s.", _this.config.port);
        });
    };
    HttpServer.prototype.stop = function () {
        this.server.close();
    };
    HttpServer.prototype.handleRequest = function (request, response) {
        if ("/" == request.url) {
            response.statusCode = HttpStatusCodes.OK;
            response.write(Util.format("%s v%s", this.appInfo.name, this.appInfo.version));
            response.end();
            return;
        }
        else
            this.processDbRequest(request, response);
    };
    HttpServer.prototype.processDbRequest = function (request, response) {
        var _this = this;
        var dbCommand = DbCommand_1.DbCommand.parseRequest(this.config.dataPath, request);
        var dbPath = dbCommand.getDbRootPath();
        var dbReady = function () {
            var action = _this.actionMap[request.method];
            if (action == null)
                throw Error(Util.format("Unhandled method '%s'.", request.method));
            try {
                action(dbCommand, request, response);
            }
            catch (err) {
                _this.badRequest(response, err);
            }
        };
        FS.exists(dbPath, function (exists) {
            if (!exists)
                FS.mkdir(dbPath, 770, function () { return dbReady(); });
            else
                dbReady();
        });
    };
    HttpServer.prototype.processGetAction = function (dbCommand, request, response) {
        if (!dbCommand.hasEntityId()) {
            var search = Search_1.Search.parseString(dbCommand.query);
            this.dbProcessor.getMany(dbCommand, search, function (data) {
                response.statusCode = HttpStatusCodes.OK;
                response.write("[");
                data.forEach(function (item, index) {
                    response.write(item);
                    if (index < (data.length - 1))
                        response.write(",");
                });
                response.end("]");
            });
        }
        else {
            this.dbProcessor.getSingle(dbCommand, function (data) {
                if (data) {
                    response.statusCode = HttpStatusCodes.OK;
                    response.end(data);
                }
                else {
                    response.statusCode = HttpStatusCodes.NOT_FOUND;
                    response.end();
                }
            });
        }
    };
    HttpServer.prototype.processPostAction = function (dbCommand, request, response) {
        var _this = this;
        this.readAndParseRequestBody(request, function (entity) {
            if (entity == null) {
                _this.badRequest(response, "Could not parse payload as JSON.");
                return;
            }
            _this.dbProcessor.saveSingle(dbCommand, entity, function (data) {
                response.statusCode = HttpStatusCodes.CREATED;
                response.setHeader("Location", Util.format("/%s/%s/%s", dbCommand.dbName, dbCommand.entityName, entity.id));
                response.end(data);
            });
        }, function (err) { return _this.badRequest(response, err); });
    };
    HttpServer.prototype.processPutAction = function (dbCommand, request, response) {
        var _this = this;
        this.readAndParseRequestBody(request, function (entity) {
            if (entity == null) {
                _this.badRequest(response, "Could not parse payload as JSON.");
                return;
            }
            // TODO Add config option to optionally perform/enforce this.
            if (entity.id != null && entity.id != dbCommand.entityId) {
                _this.badRequest(response, "The entity identifier in the URL must match that of the entity in the request body.");
                return;
            }
            _this.dbProcessor.saveSingle(dbCommand, entity, function (data) {
                response.statusCode = HttpStatusCodes.OK;
                response.end(data);
            });
        }, function (err) { return _this.badRequest(response, err); });
    };
    HttpServer.prototype.processDeleteAction = function (dbCommand, request, response) {
        this.dbProcessor.deleteSingle(dbCommand, function () {
            response.statusCode = HttpStatusCodes.OK;
            response.end();
        });
    };
    HttpServer.prototype.readRequestBody = function (request, callback) {
        var rawData = "";
        request.on("data", function (chunk) {
            rawData += chunk;
        });
        request.on("end", function () {
            callback(rawData);
        });
    };
    HttpServer.prototype.readAndParseRequestBody = function (request, callback, errorCallback) {
        this.readRequestBody(request, function (rawData) {
            var data = null;
            try {
                data = JSON.parse(rawData);
            }
            catch (err) {
                errorCallback(Util.format("Unable to parse request body as JSON. %s", err));
                return;
            }
            callback(data);
        });
    };
    HttpServer.prototype.badRequest = function (response, err) {
        response.statusCode = HttpStatusCodes.BAD_REQUEST;
        response.end(err.toString());
    };
    return HttpServer;
})();
exports.HttpServer = HttpServer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkh0dHBTZXJ2ZXIudHMiXSwibmFtZXMiOlsiSHR0cFNlcnZlciIsIkh0dHBTZXJ2ZXIuY29uc3RydWN0b3IiLCJIdHRwU2VydmVyLnJ1biIsIkh0dHBTZXJ2ZXIuc3RvcCIsIkh0dHBTZXJ2ZXIuaGFuZGxlUmVxdWVzdCIsIkh0dHBTZXJ2ZXIucHJvY2Vzc0RiUmVxdWVzdCIsIkh0dHBTZXJ2ZXIucHJvY2Vzc0dldEFjdGlvbiIsIkh0dHBTZXJ2ZXIucHJvY2Vzc1Bvc3RBY3Rpb24iLCJIdHRwU2VydmVyLnByb2Nlc3NQdXRBY3Rpb24iLCJIdHRwU2VydmVyLnByb2Nlc3NEZWxldGVBY3Rpb24iLCJIdHRwU2VydmVyLnJlYWRSZXF1ZXN0Qm9keSIsIkh0dHBTZXJ2ZXIucmVhZEFuZFBhcnNlUmVxdWVzdEJvZHkiLCJIdHRwU2VydmVyLmJhZFJlcXVlc3QiXSwibWFwcGluZ3MiOiJBQUFBLElBQVksSUFBSSxXQUFNLE1BQU0sQ0FBQyxDQUFBO0FBRTdCLElBQVksSUFBSSxXQUFNLE1BQU0sQ0FBQyxDQUFBO0FBRTdCLElBQVksRUFBRSxXQUFRLElBQUksQ0FBQyxDQUFBO0FBQzNCLElBQVksZUFBZSxXQUFNLG1CQUFtQixDQUFDLENBQUE7QUFNckQsMEJBQXdCLGFBQWEsQ0FBQyxDQUFBO0FBQ3RDLHVCQUFxQixVQUFVLENBQUMsQ0FBQTtBQUVoQyxrQ0FBZ0MscUJBQXFCLENBQUMsQ0FBQTtBQUV0RDtJQVlJQSxvQkFBWUEsT0FBZ0JBLEVBQUVBLE1BQWNBLEVBQUVBLFdBQXlCQTtRQVgvREMsY0FBU0EsR0FBR0E7WUFDaEJBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDdkNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDekNBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FB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LENBQUNBLEVBQUVBLENBQUNBO1lBQ3pDQSxRQUFRQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNuQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDUEEsQ0FBQ0E7SUFFT1Qsb0NBQWVBLEdBQXZCQSxVQUF3QkEsT0FBNkJBLEVBQUVBLFFBQWtDQTtRQUNyRlUsSUFBSUEsT0FBT0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFFakJBLE9BQU9BLENBQUNBLEVBQUVBLENBQUNBLE1BQU1BLEVBQUVBLFVBQUNBLEtBQVVBO1lBQzFCQSxPQUFPQSxJQUFJQSxLQUFLQSxDQUFDQTtRQUNyQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDSEEsT0FBT0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsS0FBS0EsRUFBRUE7WUFDZEEsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDdEJBLENBQUNBLENBQUNBLENBQUNBO0lBQ1BBLENBQUNBO0lBRU9WLDRDQUF1QkEsR0FBL0JBLFVBQWdDQSxPQUE2QkEsRUFBRUEsUUFBNEJBLEVBQUVBLGFBQTZCQTtRQUN0SFcsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsT0FBT0EsRUFBRUEsVUFBQ0EsT0FBZUE7WUFDMUNBLElBQUlBLElBQUlBLEdBQVFBLElBQUlBLENBQUNBO1lBRXJCQSxJQUFJQSxDQUFDQTtnQkFDREEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLENBQ0FBO1lBQUFBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUNUQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSwwQ0FBMENBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUM1RUEsTUFBTUEsQ0FBQ0E7WUFDWEEsQ0FBQ0E7WUFFREEsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLENBQUNBLENBQUNBLENBQUNBO0lBQ1BBLENBQUNBO0lBRU9YLCtCQUFVQSxHQUFsQkEsVUFBbUJBLFFBQTZCQSxFQUFFQSxHQUFRQTtRQUN0RFksUUFBUUEsQ0FBQ0EsVUFBVUEsR0FBR0EsZUFBZUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7UUFDbERBLFFBQVFBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLENBQUNBO0lBQ2pDQSxDQUFDQTtJQUNMWixpQkFBQ0E7QUFBREEsQ0E5S0EsQUE4S0NBLElBQUE7QUE5S1ksa0JBQVUsYUE4S3RCLENBQUEiLCJmaWxlIjoiSHR0cFNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8ifQ==
